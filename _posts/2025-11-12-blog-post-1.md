---
title: 'LLAMA-FACTORY 学习笔记'
date: 2025-11-12
permalink: /posts/2025/11/blog-post-1/
tags:
  - LLM
  - Pretrain and Tuning
  - LLAMA

---

**学习地址：[https://llamafactory.readthedocs.io/zh-cn/latest/index.html](https://llamafactory.readthedocs.io/zh-cn/latest/index.html)**

## LLama Factory 安装
通过`nvcc -v `检查cuda版本，然后执行以下代码
```bash
git clone --depth 1 https://github.com/hiyouga/LLaMA-Factory.git
cd LLaMA-Factory
pip install -e ".[torch,metrics]"
```
通过`llamafactory-cli version`检查是否安装成功，大概率会出现**环境冲突**，使用`pip install --no-deps -e .`解决，自己安装相应版本的依赖
```
pip install torch
pip install transformers
pip install omegaconf
pip install datasets==4.0.0
pip install peft==0.17.1
pip install trl==0.9.6
pip install gradio
```

## 数据准备
数据基本使用**Alpaca**格式，在**dataset_info.json**文件中添加对数据集及其内容的定义：
```python
"名称": {
  "file_name": "data.json",
  "columns": {
    "prompt": "instruction",
    "query": "input",
    "response": "output",
  }
}
```
针对不同任务如指令监督微调、预训练、偏好训练、KTO、多模态等有不同的数据格式：
- 指令监督微调数据集 
```python
"alpaca_zh_demo.json"
{
"instruction": "计算这些物品的总费用。 ",
"input": "输入：汽车 - $3000，衣服 - $100，书 - $20。",
"output": "汽车、衣服和书的总费用为 $3000 + $100 + $20 = $3120。"
},
```
- 预训练
```python
[
{"text": "document"},
{"text": "document"}
]
```
- 偏好数据集
```python
[
{
    "instruction": "人类指令（必填）",
    "input": "人类输入（选填）",
    "chosen": "优质回答（必填）",
    "rejected": "劣质回答（必填）"
}
]
```
- 多模态数据
```python
[
  {
    "instruction": "人类指令（必填）",
    "input": "人类输入（选填）",
    "output": "模型回答（必填）",
    "images": [
      "图像路径（必填）"
    ]
  }
]
```

## WebUI
通过`llamafactory-cli webui`指令进入WebUI, `curl cip.cc`查询服务器IP公网地址，访问http://ip:port


